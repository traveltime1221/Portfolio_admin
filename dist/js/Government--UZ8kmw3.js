import{s as S,r as i}from"./index-Dm95DQMK.js";import{u as G}from"./UIStore-1aKGpzaV.js";const r=async(t,n=2e4)=>{const o=new AbortController,l=setTimeout(()=>o.abort(),n);try{const s=await fetch(`https://portfolioapi-qddc.onrender.com${t}`,{headers:{"content-type":"application/json"},method:"GET",signal:o.signal});return clearTimeout(l),await s.json()}catch(s){return s.name==="AbortError"?console.error("API 請求逾時（timeout）"):console.error("API 錯誤:",s),null}},W=t=>fetch(`https://www.taiwanstat.com${t}`,{headers:{"content-type":"application/json"},method:"GET"}).then(n=>n.json().catch(o=>console.log(`異常錯誤:${o}`))),p=(t,n)=>fetch(`production${t}`,{body:JSON.stringify(n),headers:{"content-type":"application/json"},method:"POST"}).then(o=>o.json()),c={Government:{台灣水庫即時水情:()=>W("/waters/latest"),全球地震資訊:()=>r("/api/crawler/earthquake_info"),颱風天放假公布:()=>r("/api/crawler/typhoon_info"),台灣地震資訊:()=>r("/api/crawler/earthquake_tw_info"),GetWeatherWeekly:t=>r(`/api/Weather/Weekly?city=${t}`)},Person:{stocks:{GetStocks:()=>r("/api/Stock"),GetHoldingStocks:()=>r("/api/GetHoldingStocks"),AddHoldingStock:t=>p("/api/Stock/AddHoldingStock",t),RemoveHoldingStock:t=>p("/api/Stock/RemoveHoldingStock",t),UpdateHoldingStock:t=>p("/api/Stock/UpdateHoldingStock",t)}}},A=[{地區:"北部地區",水庫:[{名稱:"新山水庫",縣市:"基隆"},{名稱:"翡翠水庫",縣市:"台北、新北"},{名稱:"石門水庫",縣市:"新北、桃園、新竹"},{名稱:"永和山水庫",縣市:"新竹、苗栗"},{名稱:"寶山水庫",縣市:"新竹"},{名稱:"寶山第二水庫",縣市:"新竹"},{名稱:"明德水庫",縣市:"苗栗"},{名稱:"鯉魚潭水庫",縣市:"苗栗、台中"}]},{地區:"中部地區",水庫:[{名稱:"德基水庫",縣市:"台中"},{名稱:"石岡壩",縣市:"台中"},{名稱:"日月潭水庫",縣市:"南投"},{名稱:"霧社水庫",縣市:"南投"}]},{地區:"南部地區",水庫:[{名稱:"湖山水庫",縣市:"雲林、彰化、嘉義"},{名稱:"仁義潭水庫",縣市:"嘉義"},{名稱:"蘭潭水庫",縣市:"嘉義"},{名稱:"白河水庫",縣市:"台南"},{名稱:"曾文水庫",縣市:"嘉義、台南"},{名稱:"烏山頭水庫",縣市:"台南"},{名稱:"南化水庫",縣市:"台南、高雄"},{名稱:"阿公店水庫",縣市:"高雄"},{名稱:"牡丹水庫",縣市:"屏東"}]}],E=S("Government",()=>{const t=G(),n=i({水庫即時水情:[{地區:"",水庫:[{名稱:"",縣市:"",資訊:{baseAvailable:"",id:"",updateAt:"",volumn:"",percentage:0,daliyOverflow:"",daliyInflow:"",daliyNetflow:"",name:"",昨日水量變化:0,剩餘天數:0}}]}]}),o=i({颱風名稱:"",更新時間:"",資訊:[]}),l=i({data:[{地震時間:"",地震位置:"",深度_公里:"",經度:"",緯度:"",規模:""}]}),s=i();return{water:n,颱風天放假公布資訊:o,全球地震:l,台灣地震:s,getEarthQuackWorldInfo:async()=>{try{t.showLoading(!0);const e=await c.Government.全球地震資訊();e.status==="success"?l.value.data=e.content:console.log("取得全球地震資訊異常")}catch{console.error("撈取 全球地震資訊異常")}finally{t.showLoading(!1)}},台灣地震資訊:async()=>{try{t.showLoading(!0);const e=await c.Government.台灣地震資訊();e.status==="success"?(e.content.forEach(d=>d.active=!1),s.value=e.content):console.log("台灣地震資訊撈取異常")}catch(e){console.error("撈取 台灣地震資訊 api 異常",e)}finally{t.showLoading(!1)}},台灣水庫即時水情:async()=>{try{t.showLoading(!0);const e=await c.Government.台灣水庫即時水情();if(e&&e.length>0){const d=A.map(u=>({地區:u.地區,水庫:u.水庫.map(g=>{var m,k;const a=e[0][g.名稱]||{},f=(m=a.percentage)==null?void 0:m.toString().split(".")[1];f&&f.length>2&&(a.percentage=parseFloat(a.percentage).toFixed(1));const h=parseFloat(((k=a.volumn)==null?void 0:k.replace(/,/g,""))||"0"),w=parseFloat(a.daliyNetflow||"0"),y=h-w,v=(h-y)/y*100;return a.昨日水量變化=parseFloat(v.toFixed(2)),a.剩餘天數=Math.ceil(h/Math.abs(w||1)),{...g,資訊:a}})}));n.value.水庫即時水情=d}}catch(e){console.error("台灣水庫即時水情資訊撈取異常:",e)}finally{t.showLoading(!1)}},颱風天放假公布:async()=>{try{t.showLoading(!0);const e=await c.Government.颱風天放假公布();console.log(e),e.status==="success"?o.value=e.content:console.log("颱風天放假公布撈取異常")}catch(e){console.error("颱風天放假公布資訊撈取異常",e)}finally{t.showLoading(!1)}},getWeatherWeekly:async()=>{try{t.showLoading(!0);const e=await c.Government.GetWeatherWeekly(["台中市"]);console.log(e||"u4t;6")}catch(e){console.error(`取得一週天氣預報異常: ${e}`)}}}});export{E as u};
